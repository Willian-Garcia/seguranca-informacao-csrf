<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Alterar Senha</title>
</head>
<body>
  <h1>Alterar Senha (protegida com CSRF)</h1>
  <form id="change-form">
    <label for="password">Nova senha:</label><br />
    <input type="password" id="password" required /><br /><br />
    <button type="submit">Alterar</button>
  </form>
  <p id="status"></p>

  <script>
    let csrfToken = "";

    // Busca token CSRF
    fetch("/csrf-token", { credentials: "include" })
      .then(res => res.json())
      .then(data => csrfToken = data.csrfToken);

    const form = document.getElementById("change-form");
    const status = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const password = document.getElementById("password").value;

      const response = await fetch("/change-password-segura", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-csrf-token": csrfToken
        },
        credentials: "include",
        body: JSON.stringify({ password })
      });

      const data = await response.json();
      status.textContent = data.message || data.error;
      status.style.color = response.ok ? "green" : "red";
    });
  </script>
</body>
</html>
